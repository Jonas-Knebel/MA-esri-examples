<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>WMSLayer | Sample | ArcGIS Maps SDK for JavaScript 4.31</title>

  <style>
    html,
    body, 
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 85vh;
      width: 100%;
    }
    #requestInfo {
      height: 15vh;
      overflow-y: auto;
      background: white;
      width: 100%;
    }
  </style>

  <link rel="stylesheet" href="https://js.arcgis.com/4.31/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.31/"></script>

  <script>
    require(["esri/Map", "esri/views/SceneView", "esri/layers/WMSLayer", "esri/config"], (Map, SceneView, WMSLayer, esriConfig) => {

      /***********************************
       * Data attribution:
       *  OpenStreetMap WMS by terrestris GmbH and Co. KG. Following sources were used:
       *  (c) OpenStreetMap contributors (http://www.openstreetmap.org/copyright)
       *  (c) OpenStreetMap Data (http://openstreetmapdata.com)
       *  (c) Natural Earth Data (http://www.naturalearthdata.com)
       *  (c) ASTER GDEM 30m (https://asterweb.jpl.nasa.gov/gdem.asp)
       *  (c) SRTM 450m by ViewfinderPanoramas (http://viewfinderpanoramas.org/)
       *  (c) Great Lakes Bathymetry by NGDC (http://www.ngdc.noaa.gov/mgg/greatlakes/)
       *  (c) SRTM 30m by NASA EOSDIS Land Processes Distributed Active Archive Center (LP DAAC, https://lpdaac.usgs.gov/)
       *********************************/
      let startTime;
      const requestTimes = [];

      const esriInterceptor = [
        {
          urls: [/\b(osm\/service)\b/],
          before: () => {
            startTime = new Date().getTime();
          },
          after: (response) => {
            const endTime = new Date().getTime();
            const duration = endTime - startTime;
            requestTimes.push({ url: response.url, duration: duration, query: JSON.stringify(response.requestOptions.query) });
            updateRequestInfo();
          },
        }
      ];
      esriConfig.request.interceptors = esriInterceptor;

      function updateRequestInfo() {
        const requestInfo = requestTimes.map((req, index) => {
          return `<li>Request ${index + 1}: URL: ${req.url}, Duration: ${req.duration} ms, Query: ${req.query}</li>`;
        }).join("");
        document.getElementById("requestInfo").innerHTML = `<ul>${requestInfo}</ul>`;
      }

      const layer = new WMSLayer({
        url: "https://ows.terrestris.de/osm/service"
      });
      layer.load().then(() => {
        const sublayer = layer.findSublayerByName("OSM-WMS");
        if (sublayer) {
          layer.sublayers = [sublayer];
        }
      });

      const map = new Map({
        basemap: {
          baseLayers: [layer]
        }
      });

      const view = new SceneView({
        container: "viewDiv",
        map: map,
        spatialReference: {
          wkid: 102100
        }
      });
    });
  </script>
</head>

<body>
  <div id="viewDiv"></div>
  <div id="requestInfo">

  </div>
</body>

</html>